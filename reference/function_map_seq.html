<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content='function_map_seq() is the engine that powers functions such as
grim_map_seq(). It creates new, "factory-made" functions that apply
consistency tests such as GRIM or GRIMMER to sequences of specified
variables. The sequences are centered around the reported values of those
variables.
By default, only inconsistent values are dispersed from and tested. This
provides an easy and powerful way to assess whether small errors in
computing or reporting may be responsible for inconsistencies in published
statistics.
For background and more examples, see the
sequence
mapper section of Implementing consistency tests.'><title>Create new *_map_seq() functions — function_map_seq • scrutiny</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Create new *_map_seq() functions — function_map_seq"><meta property="og:description" content='function_map_seq() is the engine that powers functions such as
grim_map_seq(). It creates new, "factory-made" functions that apply
consistency tests such as GRIM or GRIMMER to sequences of specified
variables. The sequences are centered around the reported values of those
variables.
By default, only inconsistent values are dispersed from and tested. This
provides an easy and powerful way to assess whether small errors in
computing or reporting may be responsible for inconsistencies in published
statistics.
For background and more examples, see the
sequence
mapper section of Implementing consistency tests.'><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">scrutiny</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Consistency tests</h6>
    <a class="dropdown-item" href="../articles/grim.html">GRIM</a>
    <a class="dropdown-item" href="../articles/grimmer.html">GRIMMER</a>
    <a class="dropdown-item" href="../articles/debit.html">DEBIT</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Plausibility checks</h6>
    <a class="dropdown-item" href="../articles/duplicates.html">Duplication analysis</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Infrastructure</h6>
    <a class="dropdown-item" href="../articles/infrastructure.html">General infrastructure</a>
    <a class="dropdown-item" href="../articles/consistency-tests.html">Implementing consistency tests</a>
    <a class="dropdown-item" href="../articles/rounding.html">Rounding</a>
    <a class="dropdown-item" href="../articles/wrangling.html">Data wrangling</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Other</h6>
    <a class="dropdown-item" href="../articles/related.html">Related software</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/lhdjung/scrutiny/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Create new <code>*_map_seq()</code> functions</h1>
      <small class="dont-index">Source: <a href="https://github.com/lhdjung/scrutiny/blob/HEAD/R/function-map-seq.R" class="external-link"><code>R/function-map-seq.R</code></a></small>
      <div class="d-none name"><code>function_map_seq.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>function_map_seq()</code> is the engine that powers functions such as
<code><a href="grim_map_seq.html">grim_map_seq()</a></code>. It creates new, "factory-made" functions that apply
consistency tests such as GRIM or GRIMMER to sequences of specified
variables. The sequences are centered around the reported values of those
variables.</p>
<p>By default, only inconsistent values are dispersed from and tested. This
provides an easy and powerful way to assess whether small errors in
computing or reporting may be responsible for inconsistencies in published
statistics.</p>
<p>For background and more examples, see the
<a href="https://lhdjung.github.io/scrutiny/articles/consistency-tests.html#sequence-mapper">sequence
mapper section</a> of <em>Implementing consistency tests</em>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">function_map_seq</span><span class="op">(</span></span>
<span>  <span class="va">.fun</span>,</span>
<span>  .var <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>  <span class="va">.reported</span>,</span>
<span>  <span class="va">.name_test</span>,</span>
<span>  .name_class <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  .args_disabled <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  .dispersion <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,</span>
<span>  .out_min <span class="op">=</span> <span class="st">"auto"</span>,</span>
<span>  .out_max <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  .include_reported <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  .include_consistent <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>.fun</dt>
<dd><p>Function such as <code><a href="grim_map.html">grim_map()</a></code>: It will be used to test columns in
a data frame for consistency. Test results are Boolean and need to be
contained in a column called <code>"consistency"</code> that is added to the input
data frame. This modified data frame is then returned by <code>.fun</code>.</p></dd>


<dt>.var</dt>
<dd><p>String. Variables that will be dispersed by the manufactured
function. Defaults to <code>.reported</code>.</p></dd>


<dt>.reported</dt>
<dd><p>String. All variables the manufactured function can disperse
in principle.</p></dd>


<dt>.name_test</dt>
<dd><p>String (length 1). The name of the consistency test, such
as <code>"GRIM"</code>, to be optionally shown in a message when using the
manufactured function.</p></dd>


<dt>.name_class</dt>
<dd><p>String. If specified, the tibbles returned by the
manufactured function will inherit this string as an S3 class. Default is
<code>NULL</code>, i.e., no extra class.</p></dd>


<dt>.args_disabled</dt>
<dd><p>String. Optionally, names of the basic <code>*_map()</code>
function's arguments. These arguments will throw an error if specified when
calling the factory-made function.</p></dd>


<dt>.dispersion</dt>
<dd><p>Numeric. Sequence with steps up and down from the reported
values. It will be adjusted to these values' decimal level. For example,
with a reported <code>8.34</code>, the step size is <code>0.01</code>. Default is <code>1:5</code>, for five
steps up and down.</p></dd>


<dt>.out_min, .out_max</dt>
<dd><p>If specified when calling a factory-made function,
output will be restricted so that it's not below <code>.out_min</code> or above
<code>.out_max</code>. Defaults are <code>"auto"</code> for <code>.out_min</code>, i.e., a minimum of one
decimal unit above zero; and <code>NULL</code> for <code>.out_max</code>, i.e., no maximum.</p></dd>


<dt>.include_reported</dt>
<dd><p>Boolean. Should the reported values themselves be
included in the sequences originating from them? Default is <code>FALSE</code> because
this might be redundant and bias the results.</p></dd>


<dt>.include_consistent</dt>
<dd><p>Boolean. Should the function also process
consistent cases (from among those reported), not just inconsistent ones?
Default is <code>FALSE</code> because the focus should be on clarifying
inconsistencies.</p></dd>


<dt>...</dt>
<dd><p>These dots must be empty.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A function such as those below. ("Testable statistics" are variables
that can be selected via <code>var</code>, and are then varied. All variables except
for those in parentheses are selected by default.)</p><table class="table table"><tr><td><strong>Manufactured function</strong></td><td><strong>Testable statistics</strong></td><td><strong>Test vignette</strong></td></tr><tr><td><code><a href="grim_map_seq.html">grim_map_seq()</a></code></td><td><code>"x"</code>, <code>"n"</code>, (<code>"items"</code>)</td><td><code><a href="../articles/grim.html">vignette("grim")</a></code></td></tr><tr><td><code><a href="grimmer_map_seq.html">grimmer_map_seq()</a></code></td><td><code>"x"</code>, <code>"sd"</code>, <code>"n"</code>, (<code>"items"</code>)</td><td><code><a href="../articles/grimmer.html">vignette("grimmer")</a></code></td></tr><tr><td><code><a href="debit_map_seq.html">debit_map_seq()</a></code></td><td><code>"x"</code>, <code>"sd"</code>, <code>"n"</code></td><td><code><a href="../articles/debit.html">vignette("debit")</a></code></td></tr></table><p>The factory-made function will also have dots, <code>...</code>, to pass arguments
down to <code>.fun</code>, i.e., the basic mapper function such as <code><a href="grim_map.html">grim_map()</a></code>.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>All arguments of <code>function_map_seq()</code> set the defaults for the
arguments in the manufactured function. They can still be specified
differently when calling the latter.</p>
<p>If functions created this way are exported from other packages, they should
be written as if they were created with
<a href="https://purrr.tidyverse.org/reference/faq-adverbs-export.html" class="external-link">purrr
adverbs</a>; see explanations there, and examples in the
<a href="https://lhdjung.github.io/scrutiny/articles/consistency-tests.html#context-and-export">export
section</a> of <em>Implementing consistency tests</em>.</p>
<p>This function is a so-called function factory: It produces other functions,
such as <code><a href="grim_map_seq.html">grim_map_seq()</a></code>. More specifically, it is a function operator
because it also takes functions as inputs, such as <code><a href="grim_map.html">grim_map()</a></code>. See
Wickham (2019, ch. 10-11).</p>
    </div>
    <div class="section level2">
    <h2 id="conventions">Conventions<a class="anchor" aria-label="anchor" href="#conventions"></a></h2>
    <p>The name of a function manufactured with
<code>function_map_seq()</code> should mechanically follow from that of the input
function. For example, <code><a href="grim_map_seq.html">grim_map_seq()</a></code> derives from <code><a href="grim_map.html">grim_map()</a></code>. This
pattern fits best if the input function itself is named after the test it
performs on a data frame, followed by <code>_map</code>: <code><a href="grim_map.html">grim_map()</a></code> applies GRIM,
<code><a href="grimmer_map.html">grimmer_map()</a></code> applies GRIMMER, etc.</p>
<p>Much the same is true for the classes of data frames returned by the
manufactured function via the <code>.name_class</code> argument of
<code>function_map_seq()</code>. It should be the function's own name preceded by the
name of the package that contains it or by an acronym of that package's
name. In this way, some existing classes are <code>scr_grim_map_seq</code> and
<code>scr_grimmer_map_seq</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Wickham, H. (2019). <em>Advanced R</em> (Second Edition). CRC
Press/Taylor and Francis Group. https://adv-r.hadley.nz/index.html</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Function definition of `grim_map_seq()`:</span></span></span>
<span class="r-in"><span><span class="va">grim_map_seq</span> <span class="op">&lt;-</span> <span class="fu">function_map_seq</span><span class="op">(</span></span></span>
<span class="r-in"><span>  .fun <span class="op">=</span> <span class="va">grim_map</span>,</span></span>
<span class="r-in"><span>  .reported <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"n"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  .name_test <span class="op">=</span> <span class="st">"GRIM"</span>,</span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Lukas Jung.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

