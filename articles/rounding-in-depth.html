<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="scrutiny">
<title>Rounding in depth • scrutiny</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Rounding in depth">
<meta property="og:description" content="scrutiny">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">scrutiny</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Consistency tests</h6>
    <a class="dropdown-item" href="../articles/grim.html">GRIM</a>
    <a class="dropdown-item" href="../articles/grimmer.html">GRIMMER</a>
    <a class="dropdown-item" href="../articles/debit.html">DEBIT</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Plausibility checks</h6>
    <a class="dropdown-item" href="../articles/duplicates.html">Duplication analysis</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Quick guides</h6>
    <a class="dropdown-item" href="../articles/rounding-options.html">Rounding options</a>
    <a class="dropdown-item" href="../articles/consistency-tests-simple.html">Implementing your consistency test</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Developer tools</h6>
    <a class="dropdown-item" href="../articles/rounding-in-depth.html">Rounding in depth</a>
    <a class="dropdown-item" href="../articles/consistency-tests-in-depth.html">Consistency tests in depth</a>
    <a class="dropdown-item" href="../articles/devtools.html">Developer tools</a>
    <a class="dropdown-item" href="../articles/wrangling.html">Data wrangling</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Other</h6>
    <a class="dropdown-item" href="../articles/related.html">Related software</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/lhdjung/scrutiny/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Rounding in depth</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/lhdjung/scrutiny/blob/HEAD/vignettes/rounding-in-depth.Rmd" class="external-link"><code>vignettes/rounding-in-depth.Rmd</code></a></small>
      <div class="d-none name"><code>rounding-in-depth.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lhdjung.github.io/scrutiny/">scrutiny</a></span><span class="op">)</span></span></code></pre></div>
<p>Large parts of scrutiny are about rounding. This topic is more
diverse and variegated than one might think. “Rounding” is often taken
to simply mean rounding up from 5, and although that’s wrong, it doesn’t
make much of a difference most of the time.</p>
<p>One place where it does matter is in <em>reconstructing</em> the
rounding procedures that others used, claim to have used, or are alleged
to have used. In short, rounding and all its details matter for error
detection.</p>
<p>This vignette goes into depth on scrutiny’s infrastructure for
reconstructing rounding procedures and results from summary statistics.
All of that is essential for the package: it is a precondition for
translating assumptions about the processes behind published summary
data into a few simple, higher-level function calls. Some of the
functions presented here might be useful beyond the package, as
well.</p>
<p>Feel free to skip the more theoretical parts if your focus is on the
code. See <code><a href="../articles/rounding-options.html">vignette("rounding-options")</a></code> for a list of
possible values of the <code>rounding</code> argument in scrutiny
functions.</p>
<div class="section level3">
<h3 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h3>
<p>Base R’s <code><a href="https://rdrr.io/r/base/Round.html" class="external-link">round()</a></code> function is surprisingly sophisticated.
This distinguishes it from simpler rounding procedures, such as rounding
up from 5. For this very reason, however, it can’t be used to
reconstruct the rounding procedures of other software programs. This is
the job of scrutiny’s rounding functions.</p>
<p>First, I will present <code><a href="../reference/reround.html">reround()</a></code>, a general interface to
reconstructing rounded numbers, before going through the individual
rounding functions. I will also discuss <code><a href="../reference/unround.html">unround()</a></code>, which
works the reverse way: It takes a rounded number and reconstructs the
bounds of the original number, taking details about the assumed rounding
procedure into account. Finally, I will take a closer look at bias from
rounding raw numbers.</p>
</div>
<div class="section level3">
<h3 id="reconstruct-rounded-numbers-with-reround">Reconstruct rounded numbers with <code>reround()</code><a class="anchor" aria-label="anchor" href="#reconstruct-rounded-numbers-with-reround"></a>
</h3>
<p>None of the error detection techniques in scrutiny calls the
individual rounding functions directly. Instead, all of them call
<code><a href="../reference/reround.html">reround()</a></code>, which mediates between these two levels.
<code><a href="../reference/reround.html">reround()</a></code> takes the vector of “raw” reconstructed numbers
that were not yet rounded in the way that’s assumed to have been the
original rounding procedure. Its next argument is <code>digits</code>,
the number of decimal places to round to.</p>
<p>The remaining three arguments are about the rounding procedure. Most
of the time, only <code>rounding</code> will be of any interest. It
takes a string with the name of one of the rounding procedures discussed
below.</p>
<p>Here is an example for a <code><a href="../reference/reround.html">reround()</a></code> call:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/reround.html">reround</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5.812</span>, <span class="fl">7.249</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">2</span>, rounding <span class="op">=</span> <span class="st">"up"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 5.81 7.25</span></span></code></pre></div>
<p>The two remaining arguments are mostly forgettable: They only concern
obscure cases of rounding with a threshold other than 5
(<code>threshold</code>) and rounding such that the absolute values of
positive and negative numbers are the same (<code>symmetric</code>).
Ignore them otherwise.</p>
</div>
<div class="section level3">
<h3 id="rounding-procedures-in-detail">Rounding procedures in detail<a class="anchor" aria-label="anchor" href="#rounding-procedures-in-detail"></a>
</h3>
<div class="section level4">
<h4 id="up-and-down">Up and down<a class="anchor" aria-label="anchor" href="#up-and-down"></a>
</h4>
<p><code><a href="../reference/rounding-common.html">round_up()</a></code> does what most people think of as rounding.
If the decimal portion to be cut off by rounding is 5 or greater, it
rounds up. Otherwise, it rounds down.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/rounding-common.html">round_up</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1.24</span>, digits <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1.2</span></span>
<span></span>
<span><span class="fu"><a href="../reference/rounding-common.html">round_up</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1.25</span>, digits <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1.3</span></span>
<span></span>
<span><span class="fu"><a href="../reference/rounding-common.html">round_up</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1.25</span><span class="op">)</span>  <span class="co"># default for `digits` is 0</span></span>
<span><span class="co">#&gt; [1] 1</span></span></code></pre></div>
<p>Rounding up from 5 is actually a special case of
<code><a href="../reference/rounding-common.html">round_up_from()</a></code>, which can take any numeric threshold, not
just 5:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/rounding-common.html">round_up_from</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">4.28</span>, digits <span class="op">=</span> <span class="fl">1</span>, threshold <span class="op">=</span> <span class="fl">9</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 4.2</span></span>
<span></span>
<span><span class="fu"><a href="../reference/rounding-common.html">round_up_from</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">4.28</span>, digits <span class="op">=</span> <span class="fl">1</span>, threshold <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 4.3</span></span></code></pre></div>
<p>These two functions have their mirror images in
<code><a href="../reference/rounding-common.html">round_down()</a></code> and <code><a href="../reference/rounding-common.html">round_down_from()</a></code>. The
arguments are the same as in <code><a href="../reference/rounding-common.html">round_up()</a></code>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/rounding-common.html">round_down</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1.24</span>, digits <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1.2</span></span>
<span></span>
<span><span class="fu"><a href="../reference/rounding-common.html">round_down</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1.25</span>, digits <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1.2</span></span>
<span></span>
<span><span class="fu"><a href="../reference/rounding-common.html">round_down</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1.25</span><span class="op">)</span>  <span class="co"># default for `digits` is 0</span></span>
<span><span class="co">#&gt; [1] 1</span></span></code></pre></div>
<p><code><a href="../reference/rounding-common.html">round_down_from()</a></code>, then, is just the reverse of
<code><a href="../reference/rounding-common.html">round_up_from()</a></code>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/rounding-common.html">round_down_from</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">4.28</span>, digits <span class="op">=</span> <span class="fl">1</span>, threshold <span class="op">=</span> <span class="fl">9</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 4.3</span></span>
<span></span>
<span><span class="fu"><a href="../reference/rounding-common.html">round_down_from</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">4.28</span>, digits <span class="op">=</span> <span class="fl">1</span>, threshold <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 4.2</span></span></code></pre></div>
<p>Rounding up implements this formula:</p>
<p><span class="math display">\[
\frac{\lfloor x(10^d) +1 - \frac{t}{10} \rfloor}{10^d}
\]</span></p>
<p>where <span class="math inline">\(x\)</span> is the number to be
rounded, <span class="math inline">\(d\)</span> is the number of decimal
places to which <span class="math inline">\(x\)</span> should be
rounded, and <span class="math inline">\(t\)</span> is the threshold for
rounding up (e.g., <span class="math inline">\(t = 5\)</span> for
rounding up from 5). Note that <span class="math inline">\(\lfloor n
\rfloor\)</span> floors a number <span class="math inline">\(n\)</span>,
and <span class="math inline">\(\lceil n \rceil\)</span> ceils it.</p>
<p>Rounding down works accordingly. Note that <span class="math inline">\(+\)</span> and <span class="math inline">\(-\)</span> are reversed here:</p>
<p><span class="math display">\[
\frac{\lceil x(10^d) - 1 + \frac{t}{10} \rceil}{10^d}
\]</span></p>
</div>
<div class="section level4">
<h4 id="to-even-base-r">To even (base R)<a class="anchor" aria-label="anchor" href="#to-even-base-r"></a>
</h4>
<p>Like Python’s <a href="https://docs.python.org/3/library/functions.html#round" class="external-link"><code>round()</code></a>
function, R’s <code><a href="https://rdrr.io/r/base/Round.html" class="external-link">base::round()</a></code> doesn’t round up or down, or
use any other procedure based solely on the truncated part of the
number. Instead, <code><a href="https://rdrr.io/r/base/Round.html" class="external-link">round()</a></code> strives to round to the next even
number. This is also called “banker’s rounding”, and it follows a
technical standard, <a href="https://en.m.wikipedia.org/wiki/IEEE_754#Roundings_to_nearest" class="external-link">IEEE
754</a>.</p>
<p>Realizing that <code><a href="https://rdrr.io/r/base/Round.html" class="external-link">round()</a></code> works in a highly unintuitive way
sometimes leads to consternation. Why can’t we just round like we
learned in school, that is, up from 5? The reason seems to be bias.
Because 5 is right in between two whole numbers, any procedure that
rounds 5 in some predetermined direction introduces a bias toward that
direction. Rounding up from 5 is therefore biased upward, and rounding
down from 5 is biased downward.</p>
<p>As shown in the <em>Rounding bias</em> section below, this is
unlikely to be a major issue when rounding raw numbers that originally
have many decimal places. It might be more serious, however, if the
initial number of decimal places is low (for whatever reason) and the
need for precision is high.</p>
<p>At least in theory, “rounding to even” is not biased in either
direction, and it preserves the mean of the original distribution. That
is how <code><a href="https://rdrr.io/r/base/Round.html" class="external-link">round()</a></code> aims to operate. Here is a case in which it
works out, whereas the bias of rounding up or down is fully
apparent:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vec1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">0.5</span>, to <span class="op">=</span> <span class="fl">9.5</span><span class="op">)</span></span>
<span><span class="va">up1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rounding-common.html">round_up</a></span><span class="op">(</span><span class="va">vec1</span><span class="op">)</span></span>
<span><span class="va">down1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rounding-common.html">round_down</a></span><span class="op">(</span><span class="va">vec1</span><span class="op">)</span></span>
<span><span class="va">even1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">vec1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">vec1</span></span>
<span><span class="co">#&gt;  [1] 0.5 1.5 2.5 3.5 4.5 5.5 6.5 7.5 8.5 9.5</span></span>
<span><span class="va">up1</span></span>
<span><span class="co">#&gt;  [1]  1  2  3  4  5  6  7  8  9 10</span></span>
<span><span class="va">down1</span></span>
<span><span class="co">#&gt;  [1] 0 1 2 3 4 5 6 7 8 9</span></span>
<span><span class="va">even1</span></span>
<span><span class="co">#&gt;  [1]  0  2  2  4  4  6  6  8  8 10</span></span>
<span></span>
<span><span class="co"># Original mean</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">vec1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 5</span></span>
<span></span>
<span><span class="co"># Means when rounding up or down: bias!</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">up1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 5.5</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">down1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 4.5</span></span>
<span></span>
<span><span class="co"># Mean when rounding to even: no bias</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">even1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 5</span></span></code></pre></div>
<p>However, this noble goal of unbiased rounding runs up against the
reality of floating point arithmetic. You might therefore get results
from <code><a href="https://rdrr.io/r/base/Round.html" class="external-link">round()</a></code> that first seem bizarre, or at least
unpredictable. Consider:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vec2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">4.5</span>, to <span class="op">=</span> <span class="fl">10.5</span><span class="op">)</span></span>
<span></span>
<span><span class="va">up2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rounding-common.html">round_up</a></span><span class="op">(</span><span class="va">vec2</span><span class="op">)</span></span>
<span><span class="va">down2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rounding-common.html">round_down</a></span><span class="op">(</span><span class="va">vec2</span><span class="op">)</span></span>
<span><span class="va">even2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">vec2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">vec1</span></span>
<span><span class="co">#&gt;  [1] 0.5 1.5 2.5 3.5 4.5 5.5 6.5 7.5 8.5 9.5</span></span>
<span><span class="va">up2</span></span>
<span><span class="co">#&gt; [1]  5  6  7  8  9 10 11</span></span>
<span><span class="va">down2</span></span>
<span><span class="co">#&gt; [1]  4  5  6  7  8  9 10</span></span>
<span></span>
<span><span class="va">even2</span>  <span class="co"># No symmetry here...</span></span>
<span><span class="co">#&gt; [1]  4  6  6  8  8 10 10</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">vec2</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 7.5</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">up2</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 8</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">down2</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 7</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">even2</span><span class="op">)</span>  <span class="co"># ... and the mean is slightly biased downward!</span></span>
<span><span class="co">#&gt; [1] 7.428571</span></span>
<span></span>
<span></span>
<span><span class="va">vec3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="fl">1.05</span>, <span class="fl">1.15</span>, <span class="fl">1.25</span>, <span class="fl">1.35</span>, <span class="fl">1.45</span>,</span>
<span>  <span class="fl">1.55</span>, <span class="fl">1.65</span>, <span class="fl">1.75</span>, <span class="fl">1.85</span>, <span class="fl">1.95</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># No bias here, though:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">vec3</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] 1.0 1.1 1.2 1.4 1.4 1.6 1.6 1.8 1.9 2.0</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">vec3</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1.5</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">vec3</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1.5</span></span></code></pre></div>
<p>Sometimes <code><a href="https://rdrr.io/r/base/Round.html" class="external-link">round()</a></code> behaves just as it should, but at
other times, results can be hard to explain. Martin Mächler, who wrote
the present version of <code><a href="https://rdrr.io/r/base/Round.html" class="external-link">round()</a></code>, <a href="https://rpubs.com/maechler/Rounding" class="external-link">describes the issue</a> about
as follows:</p>
<p>The reason for the above behavior is that most decimal fractions
can’t, in fact, be represented as double precision numbers. Even
seemingly “clean” numbers with only a few decimal places come with a
long invisible mantissa, and are therefore closer to one side or the
other.</p>
<p>We usually think that rounding rules are all about breaking a tie
that occurs at 5. Most floating-point numbers, however, are just
somewhat less than or greater than 5. There is no tie! Consequently,
Mächler says, rounding functions need to “<em>measure, not guess</em>
which of the two possible decimals is closer to <code>x</code>” — and
therefore, which way to round.</p>
<p>This seems better than following mathematical intuitions that may not
always correspond to the way computers actually deal with numbers. R has
used the present solution since version 4.0.0.</p>
<p><code><a href="https://rdrr.io/r/base/Round.html" class="external-link">base::round()</a></code> can seem like a black box, but it seems
unbiased in the long run. I recommend using <code><a href="https://rdrr.io/r/base/Round.html" class="external-link">round()</a></code> for
original work, even though it is quite different from other rounding
procedures — and therefore unsuitable for reconstructing them. Instead,
we need something like scrutiny’s <code>round_*()</code> functions.</p>
</div>
<div class="section level4">
<h4 id="ieee-754-rounding-standard">IEEE 754 rounding standard<a class="anchor" aria-label="anchor" href="#ieee-754-rounding-standard"></a>
</h4>
<p><code><a href="https://rdrr.io/r/base/Round.html" class="external-link">base::round()</a></code> and some of scrutiny’s rounding functions
correspond to the IEEE 754 rounding standard (IEEE 2019, pp. 27f.; the
<a href="https://en.m.wikipedia.org/wiki/IEEE_754#Rounding_rules" class="external-link">Wikipedia
page</a> is more accessible). IEEE 754 defines standards for
floating-point operations, which includes rounding.</p>
<p>This table shows how <code><a href="https://rdrr.io/r/base/Round.html" class="external-link">base::round()</a></code> and scrutiny
correspond to IEEE 754:</p>
<table class="table">
<thead><tr class="header">
<th>Function</th>
<th>IEEE 754 attribute</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code><a href="https://rdrr.io/r/base/Round.html" class="external-link">base::round()</a></code></td>
<td><em>roundTiesToEven</em></td>
</tr>
<tr class="even">
<td>
<code><a href="../reference/rounding-common.html">round_up()</a></code> with <code>symmetric = TRUE</code>
</td>
<td><em>roundTiesToAway</em></td>
</tr>
<tr class="odd">
<td><code><a href="../reference/rounding-uncommon.html">round_ceiling()</a></code></td>
<td><em>roundTowardPositive</em></td>
</tr>
<tr class="even">
<td><code><a href="../reference/rounding-uncommon.html">round_floor()</a></code></td>
<td><em>roundTowardNegative</em></td>
</tr>
<tr class="odd">
<td><code><a href="../reference/rounding-uncommon.html">round_trunc()</a></code></td>
<td><em>roundTowardZero</em></td>
</tr>
</tbody>
</table>
<p>Admittedly, scrutiny’s rounding functions were written without this
standard in mind. That is why their names don’t match those of the IEEE
rounding procedures (or “rounding-direction attributes”), and why one of
them requires the optional <code>symmetric</code> argument to meet the
standard. A more straightforward mapping might be more desirable, and
future breaking changes in a major version of scrutiny are not out of
the question. However, other considerations apply, as well.</p>
</div>
</div>
<div class="section level3">
<h3 id="reconstruct-rounding-bounds-with-unround">Reconstruct rounding bounds with <code>unround()</code><a class="anchor" aria-label="anchor" href="#reconstruct-rounding-bounds-with-unround"></a>
</h3>
<p>Rounding leads to a loss of information. The mantissa is cut off in
part or in full, and the resulting number is underdetermined with
respect to the original number: The latter can’t be inferred from the
former. It might be of interest, however, to compute the range of the
original number given the rounded number (especially the number of
decimal places to which it was rounded) and the presumed rounding
method.</p>
<p>While it’s often easy to infer such a range, we better have the
computer do it. Enter <code><a href="../reference/unround.html">unround()</a></code>. It returns the lower and
upper bounds, and it says whether these bounds are inclusive or not —
something that varies greatly by rounding procedure. Currently,
<code><a href="../reference/unround.html">unround()</a></code> is used as a helper within scrutiny’s DEBIT
implementation; see <code><a href="../articles/debit.html">vignette("debit")</a></code>.</p>
<p>The default rounding procedure for <code><a href="../reference/unround.html">unround()</a></code> is
<code>"up_or_down"</code>:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/unround.html">unround</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"8.0"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 7</span></span></span>
<span><span class="co">#&gt;   range                  rounding   lower incl_lower x     incl_upper upper</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 7.95 &lt;= x(8.0) &lt;= 8.05 up_or_down  7.95 TRUE       8.0   TRUE        8.05</span></span></code></pre></div>
<p>For a complete list of featured rounding procedures, see
documentation for <code><a href="../reference/unround.html">unround()</a></code>, section <em>Rounding</em>.</p>
<p>On the left, the <code>range</code> column displays a pithy graphical
overview of the other columns (except for <code>rounding</code>) in the
same order:</p>
<ol style="list-style-type: decimal">
<li>
<code>lower</code> is the lower bound for the original number.</li>
<li>
<code>incl_lower</code> is <code>TRUE</code> if the lower bound is
inclusive and <code>FALSE</code> otherwise.</li>
<li>
<code>x</code> is the input value.</li>
<li>
<code>incl_upper</code> is <code>TRUE</code> if the upper bound is
inclusive and <code>FALSE</code> otherwise.</li>
<li>
<code>upper</code> is the upper bound for the original number.</li>
</ol>
<p>By default, decimal places are counted internally so that the
function always operates on the appropriate decimal level. This creates
a need to take trailing zeros into account, which is why <code>x</code>
needs to be a string:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/unround.html">unround</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"3.50"</span>, rounding <span class="op">=</span> <span class="st">"up"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 7</span></span></span>
<span><span class="co">#&gt;   range                    rounding lower incl_lower x     incl_upper upper</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 3.495 &lt;= x(3.50) &lt; 3.505 up        3.50 TRUE       3.50  FALSE       3.50</span></span></code></pre></div>
<p>Alternatively, a function that uses <code><a href="../reference/unround.html">unround()</a></code> as a
helper might count decimal places by itself (i.e., by internally calling
<code><a href="../reference/decimal_places.html">decimal_places()</a></code>). It should then pass these numbers to
<code><a href="../reference/unround.html">unround()</a></code> via the <code>decimals</code> argument instead of
letting it redundantly count decimal places a second time.</p>
<p>In this case, <code>x</code> can be numeric because trailing zeros
are no longer needed. (That, in turn, is because the responsibility to
count decimal places in number-strings rather than numeric values shifts
from <code><a href="../reference/unround.html">unround()</a></code> to the higher-level function.)</p>
<p>The following call returns the exact same tibble as above:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/unround.html">unround</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">3.5</span>, digits <span class="op">=</span> <span class="fl">2</span>, rounding <span class="op">=</span> <span class="st">"up"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 7</span></span></span>
<span><span class="co">#&gt;   range                   rounding lower incl_lower     x incl_upper upper</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 3.495 &lt;= x(3.5) &lt; 3.505 up        3.50 TRUE         3.5 FALSE       3.50</span></span></code></pre></div>
<p>Since <code>x</code> is vectorized, you might test several reported
numbers at once:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vec2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3.1</span>, <span class="fl">3.5</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/restore_zeros.html">restore_zeros</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">vec2</span>   <span class="co"># `restore_zeros()` returns "2.0" for 2</span></span>
<span><span class="co">#&gt; [1] "2.0" "3.1" "3.5"</span></span>
<span></span>
<span><span class="va">vec2</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/unround.html">unround</a></span><span class="op">(</span>rounding <span class="op">=</span> <span class="st">"even"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 7</span></span></span>
<span><span class="co">#&gt;   range                rounding lower incl_lower x     incl_upper upper</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 1.95 &lt; x(2.0) &lt; 2.05 even      1.95 FALSE      2.0   FALSE       2.05</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 3.05 &lt; x(3.1) &lt; 3.15 even      3.05 FALSE      3.1   FALSE       3.15</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 3.45 &lt; x(3.5) &lt; 3.55 even      3.45 FALSE      3.5   FALSE       3.55</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="fractional-rounding">Fractional rounding<a class="anchor" aria-label="anchor" href="#fractional-rounding"></a>
</h3>
<p>What if you want to round numbers to a fraction instead of an
integer? Check out <code><a href="../reference/fractional-rounding.html">reround_to_fraction()</a></code> and
<code><a href="../reference/fractional-rounding.html">reround_to_fraction_level()</a></code>:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/fractional-rounding.html">reround_to_fraction</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0.4</span>, denominator <span class="op">=</span> <span class="fl">2</span>, rounding <span class="op">=</span> <span class="st">"up"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.5</span></span></code></pre></div>
<p>This function rounds <code>0.4</code> to <code>0.5</code> because
that’s the closest fraction of <code>2</code>. It is inspired by
<code>janitor::round_to_fraction()</code>, and credit for the core
implementation goes there. <code><a href="../reference/fractional-rounding.html">reround_to_fraction()</a></code> blends
janitor’s fractional rounding with the flexibility and precision that
<code><a href="../reference/reround.html">reround()</a></code> provides.</p>
<p>What’s more, <code><a href="../reference/fractional-rounding.html">reround_to_fraction_level()</a></code> rounds to the
nearest fraction at the decimal level specified via its
<code>digits</code> argument:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/fractional-rounding.html">reround_to_fraction_level</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fl">0.777</span>, denominator <span class="op">=</span> <span class="fl">5</span>, digits <span class="op">=</span> <span class="fl">0</span>, rounding <span class="op">=</span> <span class="st">"down"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.8</span></span>
<span><span class="fu"><a href="../reference/fractional-rounding.html">reround_to_fraction_level</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fl">0.777</span>, denominator <span class="op">=</span> <span class="fl">5</span>, digits <span class="op">=</span> <span class="fl">1</span>, rounding <span class="op">=</span> <span class="st">"down"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.78</span></span>
<span><span class="fu"><a href="../reference/fractional-rounding.html">reround_to_fraction_level</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fl">0.777</span>, denominator <span class="op">=</span> <span class="fl">5</span>, digits <span class="op">=</span> <span class="fl">2</span>, rounding <span class="op">=</span> <span class="st">"down"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.776</span></span></code></pre></div>
<p>These two functions are not currently part of any error detection
workflow.</p>
</div>
<div class="section level3">
<h3 id="rounding-bias">Rounding bias<a class="anchor" aria-label="anchor" href="#rounding-bias"></a>
</h3>
<p>I wrote above that rounding up or down from 5 is biased. However,
this points to a wider problem: It is true of any rounding procedure
that doesn’t take active precautions against such bias.
<code><a href="https://rdrr.io/r/base/Round.html" class="external-link">base::round()</a></code> does, and that is why I recommend it for
original work (as opposed to reconstruction).</p>
<p>It might be useful to have a general and flexible way to quantify how
far rounding biases a distribution, as compared to how it looked like
before rounding. The function <code><a href="../reference/rounding_bias.html">rounding_bias()</a></code> fulfills this
role. It is a wrapper around <code><a href="../reference/reround.html">reround()</a></code>, so it can access
any rounding procedure that <code><a href="../reference/reround.html">reround()</a></code> can, and takes all of
the same arguments. However, the default for <code>rounding</code> is
<code>"up"</code> instead of <code>"up_or_down"</code> because
<code><a href="../reference/rounding_bias.html">rounding_bias()</a></code> only makes sense with single rounding
procedures.</p>
<p>In general, bias due to rounding is computed by subtracting the
original distribution from the rounded one:</p>
<p><span class="math display">\[
bias = x_{rounded} - x
\]</span></p>
<p>By default, the mean is computed to reduce the bias to a single data
point:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vec3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">0.6</span>, to <span class="op">=</span> <span class="fl">0.7</span>, by <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span></span>
<span></span>
<span><span class="va">vec3</span></span>
<span><span class="co">#&gt;  [1] 0.60 0.61 0.62 0.63 0.64 0.65 0.66 0.67 0.68 0.69 0.70</span></span>
<span></span>
<span><span class="co"># The mean before rounding...</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">vec3</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.65</span></span>
<span></span>
<span><span class="co"># ...is not the same as afterwards...</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="../reference/rounding-common.html">round_up</a></span><span class="op">(</span><span class="va">vec3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span></span>
<span><span class="co"># ...and the difference is bias:</span></span>
<span><span class="fu"><a href="../reference/rounding_bias.html">rounding_bias</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">vec3</span>, digits <span class="op">=</span> <span class="fl">0</span>, rounding <span class="op">=</span> <span class="st">"up"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.35</span></span></code></pre></div>
<p>Set <code>mean</code> to <code>FALSE</code> to return the whole
vector of individual biases instead:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/rounding_bias.html">rounding_bias</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">vec3</span>, digits <span class="op">=</span> <span class="fl">0</span>, rounding <span class="op">=</span> <span class="st">"up"</span>, mean <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] 0.40 0.39 0.38 0.37 0.36 0.35 0.34 0.33 0.32 0.31 0.30</span></span></code></pre></div>
<p>Admittedly, this example is somewhat overdramatic. Here is a rather
harmless one:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vec4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">50000</span>, <span class="fl">100</span>, <span class="fl">15</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/rounding_bias.html">rounding_bias</a></span><span class="op">(</span><span class="va">vec4</span>, digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 2.668842e-05</span></span></code></pre></div>
<p>What is responsible for such a difference? It seems to be (1) the
sample size and (2) the number of decimal places to which the vector is
rounded. The rounding method doesn’t appear to matter if numbers with
many decimal places are rounded:</p>
<pre><code><span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 10 × 3</span></span></span>
<span><span class="co">#&gt;            bias decimal_digits rounding</span></span>
<span><span class="co">#&gt;           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 0.000<span style="text-decoration: underline;">173</span>     1 up           up      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 0.000<span style="text-decoration: underline;">026</span>7    2 up           up      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 0.000<span style="text-decoration: underline;">000</span>812  3 up           up      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 0.000<span style="text-decoration: underline;">000</span>060<span style="text-decoration: underline;">4</span> 4 up           up      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 0.000<span style="text-decoration: underline;">000</span>011<span style="text-decoration: underline;">4</span> 5 up           up      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 0.000<span style="text-decoration: underline;">173</span>     1 even         even    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 0.000<span style="text-decoration: underline;">026</span>7    2 even         even    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 0.000<span style="text-decoration: underline;">000</span>812  3 even         even    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 0.000<span style="text-decoration: underline;">000</span>060<span style="text-decoration: underline;">4</span> 4 even         even    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 0.000<span style="text-decoration: underline;">000</span>011<span style="text-decoration: underline;">4</span> 5 even         even</span></span></code></pre>
<p><img src="rounding-in-depth_files/figure-html/unnamed-chunk-18-1.png" width="700"></p>
<p>However, if the raw values are preliminarily rounded to 2 decimal
places before rounding proceeds as above, the picture is different:</p>
<pre><code><span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 10 × 3</span></span></span>
<span><span class="co">#&gt;          bias decimal_digits rounding</span></span>
<span><span class="co">#&gt;         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 0.005<span style="text-decoration: underline;">08</span>    1 up           up      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 0          2 up           up      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 0          3 up           up      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 0          4 up           up      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 0          5 up           up      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 0.000<span style="text-decoration: underline;">005</span>80 1 even         even    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 0          2 even         even    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 0          3 even         even    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 0          4 even         even    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 0          5 even         even</span></span></code></pre>
<p><img src="rounding-in-depth_files/figure-html/unnamed-chunk-19-1.png" width="700"></p>
<p>In sum, the function allows users to quantify the degree to which
rounding biases a distribution, so that they can assess the relative
merits of different rounding procedures. This is partly to sensitize
readers to potential bias in edge cases, but also to enable them to make
informed rounding decisions on their own.</p>
<div class="section level4" style="display: none;">
<h4 style="display: none;" id="citation-dummy">Citation dummy<a class="anchor" aria-label="anchor" href="#citation-dummy"></a>
</h4>
<p><em>(Here is an extra section. Its display is suppressed via the CSS
element <code>display: none;</code> because its only purpose is to
generate the citation <span class="citation">IEEE (2019)</span> — I want
to style the citation in the text above more flexibly than the format
allows (without parentheses) but still get the reference pasted at the
bottom.)</em></p>
</div>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-ieee2019" class="csl-entry">
IEEE. 2019. <span>“IEEE Standard for Floating-Point Arithmetic.”</span>
<a href="https://doi.org/10.1109/IEEESTD.2019.8766229" class="external-link">https://doi.org/10.1109/IEEESTD.2019.8766229</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Lukas Jung.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
