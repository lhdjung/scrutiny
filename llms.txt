# scrutiny: Error detection in science

The goal of scrutiny is to test published summary statistics for
consistency using techniques like GRIM and to check their plausibility.
The package makes these methods easy to use in a tidyverse-friendly way.
It hopes to help the new field of error detection go mainstream.

You can use the most important parts in the [Error
detection](https://errors.shinyapps.io/scrutiny) Shiny app instead.

Besides ready-made tests, scrutiny features a complete system for
implementing new consistency tests. It also has duplication analysis,
more general infrastructure for implementing error detection techniques,
as well as specialized data wrangling functions. See the *Articles* tab
for vignettes.

Install the package from CRAN:

``` r
install.packages("scrutiny")
```

Alternatively, install the development version from GitHub:

``` r
remotes::install_github("lhdjung/scrutiny")
```

## Get started

Here is how to GRIM-test all values in a data frame. When using
[`grim_map()`](https://lhdjung.github.io/scrutiny/reference/grim_map.md),
the `consistency` column tells you if the means (`x`) and sample sizes
(`n`) are mutually consistent.

``` r
library(scrutiny)

# Example data:
pigs1
#> # A tibble: 12 × 2
#>    x         n
#>    <chr> <dbl>
#>  1 7.22     32
#>  2 4.74     25
#>  3 5.23     29
#>  4 2.57     24
#>  5 6.77     27
#>  6 2.68     28
#>  7 7.01     29
#>  8 7.38     26
#>  9 3.14     27
#> 10 6.89     31
#> 11 5.00     25
#> 12 0.24     28

# GRIM-testing for data frames:
grim_map(pigs1)
#> # A tibble: 12 × 4
#>    x         n consistency probability
#>    <chr> <dbl> <lgl>             <dbl>
#>  1 7.22     32 TRUE               0.68
#>  2 4.74     25 FALSE              0.75
#>  3 5.23     29 FALSE              0.71
#>  4 2.57     24 FALSE              0.76
#>  5 6.77     27 FALSE              0.73
#>  6 2.68     28 TRUE               0.72
#>  7 7.01     29 FALSE              0.71
#>  8 7.38     26 TRUE               0.74
#>  9 3.14     27 FALSE              0.73
#> 10 6.89     31 FALSE              0.69
#> 11 5.00     25 TRUE               0.75
#> 12 0.24     28 FALSE              0.72
```

Test percentages instead of means:

``` r
pigs2
#> # A tibble: 6 × 2
#>   x         n
#>   <chr> <dbl>
#> 1 67.4    150
#> 2 54.2    150
#> 3 54.0    150
#> 4 69.8    150
#> 5 68.1    150
#> 6 55.4    150

grim_map(pigs2, percent = TRUE)
#> ℹ `x` converted from percentage
#> # A tibble: 6 × 4
#>   x         n consistency probability
#>   <chr> <dbl> <lgl>             <dbl>
#> 1 0.674   150 FALSE              0.85
#> 2 0.542   150 FALSE              0.85
#> 3 0.540   150 TRUE               0.85
#> 4 0.698   150 FALSE              0.85
#> 5 0.681   150 FALSE              0.85
#> 6 0.554   150 FALSE              0.85
```

You can choose how the means are reconstructed for testing — below,
rounded up from 5. When visualizing results, the plot will adjust
automatically. Blue dots are consistent values, red dots are
inconsistent ones:

``` r
pigs1 %>% 
  grim_map(rounding = "up") %>% 
  grim_plot()
```

![](reference/figures/README-unnamed-chunk-5-1.png)

Similarly, use DEBIT to test means and standard deviations of binary
data:

``` r
pigs3
#> # A tibble: 7 × 3
#>   x     sd        n
#>   <chr> <chr> <dbl>
#> 1 0.53  0.50   1683
#> 2 0.44  0.50   1683
#> 3 0.77  0.42   1683
#> 4 0.19  0.35   1683
#> 5 0.34  0.47   1683
#> 6 0.93  0.25   1683
#> 7 0.12  0.33   1683

pigs3 %>% 
  debit_map()
#> # A tibble: 7 × 11
#>   x     sd        n consistency rounding   sd_lower sd_incl_lower sd_upper
#>   <chr> <chr> <int> <lgl>       <chr>         <dbl> <lgl>            <dbl>
#> 1 0.53  0.50   1683 TRUE        up_or_down    0.495 TRUE             0.505
#> 2 0.44  0.50   1683 TRUE        up_or_down    0.495 TRUE             0.505
#> 3 0.77  0.42   1683 TRUE        up_or_down    0.415 TRUE             0.425
#> 4 0.19  0.35   1683 FALSE       up_or_down    0.345 TRUE             0.355
#> 5 0.34  0.47   1683 TRUE        up_or_down    0.465 TRUE             0.475
#> 6 0.93  0.25   1683 TRUE        up_or_down    0.245 TRUE             0.255
#> 7 0.12  0.33   1683 TRUE        up_or_down    0.325 TRUE             0.335
#> # ℹ 3 more variables: sd_incl_upper <lgl>, x_lower <dbl>, x_upper <dbl>

pigs3 %>% 
  debit_map() %>% 
  debit_plot()
```

![](reference/figures/README-unnamed-chunk-6-1.png)

## Guiding ideas

> (…) a critical inspection of the published literature should not be
> mischaracterized as a hobby for the overly cynical, nor as so-called
> “methodological terrorism”. On the contrary, carefully evaluating
> presented data is a cornerstone of scientific investigation, and it is
> only logical to apply this also to the published literature. If we are
> not willing to critically assess published studies, we also cannot
> guarantee their veracity.

— van der Zee et al. (2017, pp. 8-9)

> (…) data thugs (…) demand data and if they do not receive it, they
> contact editors and universities and threaten to write blogs and
> tweets about the errors uncovered.

— Eric A. Stewart (six retractions; quoted in Pickett 2020, p. 178)

# References

Pickett, J. T. (2020). The Stewart Retractions: A Quantitative and
Qualitative Analysis. *Econ Journal Watch*, *17*(1), 152–190.
<https://econjwatch.org/articles/the-stewart-retractions-a-quantitative-and-qualitative-analysis>.

van der Zee, T., Anaya, J., & Brown, N. J. L. (2017). Statistical
heartburn: An attempt to digest four pizza publications from the Cornell
Food and Brand Lab. *BMC Nutrition*, *3*(1), 54.
<https://doi.org/10.1186/s40795-017-0167-x>.

# Package index

## Consistency tests

Check the numerical consistency of summary statistics; three tests
currently implemented —

### GRIM

Test reported means or percentages for numerical consistency with
reported sample sizes

- [`grim()`](https://lhdjung.github.io/scrutiny/reference/grim.md) : The
  GRIM test (granularity-related inconsistency of means)
- [`grim_map()`](https://lhdjung.github.io/scrutiny/reference/grim_map.md)
  : GRIM-test many cases at once
- [`grim_map_seq()`](https://lhdjung.github.io/scrutiny/reference/grim_map_seq.md)
  : GRIM-testing with dispersed inputs
- [`grim_map_total_n()`](https://lhdjung.github.io/scrutiny/reference/grim_map_total_n.md)
  : GRIM-testing with hypothetical group sizes
- [`grim_plot()`](https://lhdjung.github.io/scrutiny/reference/grim_plot.md)
  : Visualize GRIM test results
- [`grim_probability()`](https://lhdjung.github.io/scrutiny/reference/grim-stats.md)
  [`grim_ratio()`](https://lhdjung.github.io/scrutiny/reference/grim-stats.md)
  [`grim_total()`](https://lhdjung.github.io/scrutiny/reference/grim-stats.md)
  : Possible GRIM inconsistencies
- [`grim_granularity()`](https://lhdjung.github.io/scrutiny/reference/grim_granularity.md)
  [`grim_items()`](https://lhdjung.github.io/scrutiny/reference/grim_granularity.md)
  : Granularity of non-continuous scales

### GRIMMER

Test reported means and standard deviations for numerical consistency
with reported sample sizes

- [`grimmer()`](https://lhdjung.github.io/scrutiny/reference/grimmer.md)
  : The GRIMMER test (granularity-related inconsistency of means mapped
  to error repeats)
- [`grimmer_map()`](https://lhdjung.github.io/scrutiny/reference/grimmer_map.md)
  : GRIMMER-test many cases at once
- [`grimmer_map_seq()`](https://lhdjung.github.io/scrutiny/reference/grimmer_map_seq.md)
  : GRIMMER-testing with dispersed inputs
- [`grimmer_map_total_n()`](https://lhdjung.github.io/scrutiny/reference/grimmer_map_total_n.md)
  : GRIMMER-testing with hypothetical group sizes

### DEBIT

Test reported means and standard deviations of binary data for numerical
consistency with reported sample sizes

- [`debit()`](https://lhdjung.github.io/scrutiny/reference/debit.md) :
  The DEBIT (descriptive binary) test
- [`debit_map()`](https://lhdjung.github.io/scrutiny/reference/debit_map.md)
  : Apply DEBIT to many cases
- [`debit_map_seq()`](https://lhdjung.github.io/scrutiny/reference/debit_map_seq.md)
  : Using DEBIT with dispersed inputs
- [`debit_map_total_n()`](https://lhdjung.github.io/scrutiny/reference/debit_map_total_n.md)
  : Use DEBIT with hypothetical group sizes
- [`debit_plot()`](https://lhdjung.github.io/scrutiny/reference/debit_plot.md)
  : Visualize DEBIT results
- [`sd_binary_groups()`](https://lhdjung.github.io/scrutiny/reference/sd-binary.md)
  [`sd_binary_0_n()`](https://lhdjung.github.io/scrutiny/reference/sd-binary.md)
  [`sd_binary_1_n()`](https://lhdjung.github.io/scrutiny/reference/sd-binary.md)
  [`sd_binary_mean_n()`](https://lhdjung.github.io/scrutiny/reference/sd-binary.md)
  : Standard deviation of binary data

## Duplicate detection

Blunt functions to tentatively discover and count duplicate numeric
values; interpret results with care

- [`duplicate_count()`](https://lhdjung.github.io/scrutiny/reference/duplicate_count.md)
  : Count duplicate values
- [`duplicate_count_colpair()`](https://lhdjung.github.io/scrutiny/reference/duplicate_count_colpair.md)
  : Count duplicate values by column
- [`duplicate_tally()`](https://lhdjung.github.io/scrutiny/reference/duplicate_tally.md)
  : Count duplicates at each observation

## Summarize scrutiny tests

Follow up on scrutiny’s testing functions by computing specific summary
statistics

- [`audit()`](https://lhdjung.github.io/scrutiny/reference/audit.md) :
  Summarize scrutiny objects
- [`audit_seq()`](https://lhdjung.github.io/scrutiny/reference/audit-special.md)
  [`audit_total_n()`](https://lhdjung.github.io/scrutiny/reference/audit-special.md)
  : Summarize output of sequence mappers and total-n mappers

## Developer tools

Helpers for implementing error detection techniques

### Function factories

Easily create new mapper functions for consistency tests

- [`function_map()`](https://lhdjung.github.io/scrutiny/reference/function_map.md)
  :

  Create new `*_map()` functions

- [`function_map_seq()`](https://lhdjung.github.io/scrutiny/reference/function_map_seq.md)
  :

  Create new `*_map_seq()` functions

- [`function_map_total_n()`](https://lhdjung.github.io/scrutiny/reference/function_map_total_n.md)
  :

  Create new `*_map_total_n()` functions

- [`reverse_map_seq()`](https://lhdjung.github.io/scrutiny/reference/reverse_map_seq.md)
  :

  Reverse the `*_map_seq()` process

- [`reverse_map_total_n()`](https://lhdjung.github.io/scrutiny/reference/reverse_map_total_n.md)
  :

  Reverse the `*_map_total_n()` process

- [`check_args_disabled()`](https://lhdjung.github.io/scrutiny/reference/check_args_disabled.md)
  : Check that disabled arguments are not specified

- [`check_factory_dots()`](https://lhdjung.github.io/scrutiny/reference/check_factory_dots.md)
  : Check that no dots-argument is misspelled

- [`absorb_key_args()`](https://lhdjung.github.io/scrutiny/reference/absorb_key_args.md)
  : Absorb key arguments from the user's call

### Rounding

Reconstruct rounding procedures

- [`round_up_from()`](https://lhdjung.github.io/scrutiny/reference/rounding-common.md)
  [`round_down_from()`](https://lhdjung.github.io/scrutiny/reference/rounding-common.md)
  [`round_up()`](https://lhdjung.github.io/scrutiny/reference/rounding-common.md)
  [`round_down()`](https://lhdjung.github.io/scrutiny/reference/rounding-common.md)
  : Common rounding procedures
- [`round_ceiling()`](https://lhdjung.github.io/scrutiny/reference/rounding-uncommon.md)
  [`round_floor()`](https://lhdjung.github.io/scrutiny/reference/rounding-uncommon.md)
  [`round_trunc()`](https://lhdjung.github.io/scrutiny/reference/rounding-uncommon.md)
  [`anti_trunc()`](https://lhdjung.github.io/scrutiny/reference/rounding-uncommon.md)
  [`round_anti_trunc()`](https://lhdjung.github.io/scrutiny/reference/rounding-uncommon.md)
  : Uncommon rounding procedures
- [`reround()`](https://lhdjung.github.io/scrutiny/reference/reround.md)
  : General interface to reconstructing rounded numbers
- [`reround_to_fraction()`](https://lhdjung.github.io/scrutiny/reference/fractional-rounding.md)
  [`reround_to_fraction_level()`](https://lhdjung.github.io/scrutiny/reference/fractional-rounding.md)
  : Generalized rounding to the nearest fraction of a specified
  denominator
- [`unround()`](https://lhdjung.github.io/scrutiny/reference/unround.md)
  : Reconstruct rounding bounds
- [`rounding_bias()`](https://lhdjung.github.io/scrutiny/reference/rounding_bias.md)
  : Compute rounding bias

### Counting decimal places

- [`decimal_places()`](https://lhdjung.github.io/scrutiny/reference/decimal_places.md)
  [`decimal_places_scalar()`](https://lhdjung.github.io/scrutiny/reference/decimal_places.md)
  : Count decimal places
- [`decimal_places_df()`](https://lhdjung.github.io/scrutiny/reference/decimal_places_df.md)
  : Count decimal places in a data frame

### Sequence generation

- [`seq_endpoint()`](https://lhdjung.github.io/scrutiny/reference/seq-decimal.md)
  [`seq_distance()`](https://lhdjung.github.io/scrutiny/reference/seq-decimal.md)
  [`seq_endpoint_df()`](https://lhdjung.github.io/scrutiny/reference/seq-decimal.md)
  [`seq_distance_df()`](https://lhdjung.github.io/scrutiny/reference/seq-decimal.md)
  : Sequence generation at decimal level
- [`seq_test_ranking()`](https://lhdjung.github.io/scrutiny/reference/seq_test_ranking.md)
  : Rank sequence test results
- [`seq_disperse()`](https://lhdjung.github.io/scrutiny/reference/seq_disperse.md)
  [`seq_disperse_df()`](https://lhdjung.github.io/scrutiny/reference/seq_disperse.md)
  : Sequence generation with dispersion at decimal level
- [`disperse()`](https://lhdjung.github.io/scrutiny/reference/disperse.md)
  [`disperse2()`](https://lhdjung.github.io/scrutiny/reference/disperse.md)
  [`disperse_total()`](https://lhdjung.github.io/scrutiny/reference/disperse.md)
  : Vary hypothetical group sizes
- [`seq_length()`](https://lhdjung.github.io/scrutiny/reference/seq_length.md)
  [`` `seq_length<-`() ``](https://lhdjung.github.io/scrutiny/reference/seq_length.md)
  : Set sequence length
- [`is_seq_linear()`](https://lhdjung.github.io/scrutiny/reference/seq-predicates.md)
  [`is_seq_ascending()`](https://lhdjung.github.io/scrutiny/reference/seq-predicates.md)
  [`is_seq_descending()`](https://lhdjung.github.io/scrutiny/reference/seq-predicates.md)
  [`is_seq_dispersed()`](https://lhdjung.github.io/scrutiny/reference/seq-predicates.md)
  : Is a vector a certain kind of sequence?

### Documentation templates

Return standardized building blocks for documenting specific kinds of
functions

- [`write_doc_audit()`](https://lhdjung.github.io/scrutiny/reference/write_doc_audit.md)
  :

  Documentation template for
  [`audit()`](https://lhdjung.github.io/scrutiny/reference/audit.md)

- [`write_doc_audit_seq()`](https://lhdjung.github.io/scrutiny/reference/write_doc_audit_seq.md)
  :

  Documentation template for
  [`audit_seq()`](https://lhdjung.github.io/scrutiny/reference/audit-special.md)

- [`write_doc_audit_total_n()`](https://lhdjung.github.io/scrutiny/reference/write_doc_audit_total_n.md)
  :

  Documentation template for
  [`audit_total_n()`](https://lhdjung.github.io/scrutiny/reference/audit-special.md)

- [`write_doc_factory_map_conventions()`](https://lhdjung.github.io/scrutiny/reference/write_doc_factory_map_conventions.md)
  : Documentation template for function factory conventions

### Consistency test helpers

Call these helpers inside of your own functions that implement
consistency tests at various levels

- [`check_mapper_input_colnames()`](https://lhdjung.github.io/scrutiny/reference/check_mapper_input_colnames.md)
  : Check that a mapper's input has correct column names

- [`manage_helper_col()`](https://lhdjung.github.io/scrutiny/reference/manage_helper_col.md)
  : Helper column operations

- [`manage_key_colnames()`](https://lhdjung.github.io/scrutiny/reference/manage_key_colnames.md)
  : Enable name-independent key column identification

- [`unnest_consistency_cols()`](https://lhdjung.github.io/scrutiny/reference/unnest_consistency_cols.md)
  : Unnest a test result column

- [`audit_cols_minimal()`](https://lhdjung.github.io/scrutiny/reference/audit_cols_minimal.md)
  :

  Compute minimal
  [`audit()`](https://lhdjung.github.io/scrutiny/reference/audit.md)
  summaries

- [`check_audit_special()`](https://lhdjung.github.io/scrutiny/reference/check_audit_special.md)
  :

  Alert user if more specific `audit_*()` summaries are available

### Data frame predicates

Test for mapper function output

- [`is_map_df()`](https://lhdjung.github.io/scrutiny/reference/data-frame-predicates.md)
  [`is_map_basic_df()`](https://lhdjung.github.io/scrutiny/reference/data-frame-predicates.md)
  [`is_map_seq_df()`](https://lhdjung.github.io/scrutiny/reference/data-frame-predicates.md)
  [`is_map_total_n_df()`](https://lhdjung.github.io/scrutiny/reference/data-frame-predicates.md)
  : Is an object a consistency test output tibble?

### Testing for subsets / supersets

Predicate functions for logical relations between vectors, supporting
flexible data entry and tidy evaluation

- [`is_subset_of()`](https://lhdjung.github.io/scrutiny/reference/subset-superset.md)
  [`is_superset_of()`](https://lhdjung.github.io/scrutiny/reference/subset-superset.md)
  [`is_equal_set()`](https://lhdjung.github.io/scrutiny/reference/subset-superset.md)
  [`is_proper_subset_of()`](https://lhdjung.github.io/scrutiny/reference/subset-superset.md)
  [`is_proper_superset_of()`](https://lhdjung.github.io/scrutiny/reference/subset-superset.md)
  [`is_subset_of_vals()`](https://lhdjung.github.io/scrutiny/reference/subset-superset.md)
  [`is_superset_of_vals()`](https://lhdjung.github.io/scrutiny/reference/subset-superset.md)
  [`is_equal_set_vals()`](https://lhdjung.github.io/scrutiny/reference/subset-superset.md)
  [`is_proper_subset_of_vals()`](https://lhdjung.github.io/scrutiny/reference/subset-superset.md)
  [`is_proper_superset_of_vals()`](https://lhdjung.github.io/scrutiny/reference/subset-superset.md)
  [`is_subset_of_vecs()`](https://lhdjung.github.io/scrutiny/reference/subset-superset.md)
  [`is_superset_of_vecs()`](https://lhdjung.github.io/scrutiny/reference/subset-superset.md)
  [`is_equal_set_vecs()`](https://lhdjung.github.io/scrutiny/reference/subset-superset.md)
  [`is_proper_subset_of_vecs()`](https://lhdjung.github.io/scrutiny/reference/subset-superset.md)
  [`is_proper_superset_of_vecs()`](https://lhdjung.github.io/scrutiny/reference/subset-superset.md)
  **\[deprecated\]** : Test for subsets, supersets, and equal sets

### Testing for numeric-like vectors

- [`is_numeric_like()`](https://lhdjung.github.io/scrutiny/reference/is_numeric_like.md)
  : Test whether a vector is numeric or coercible to numeric

## Data wrangling

Automate formatting tasks with a special relevance to error detection

- [`restore_zeros()`](https://lhdjung.github.io/scrutiny/reference/restore_zeros.md)
  [`restore_zeros_df()`](https://lhdjung.github.io/scrutiny/reference/restore_zeros.md)
  : Restore trailing zeros
- [`split_by_parens()`](https://lhdjung.github.io/scrutiny/reference/split_by_parens.md)
  : Split columns by parentheses, brackets, braces, or similar
- [`before_parens()`](https://lhdjung.github.io/scrutiny/reference/parens-extractors.md)
  [`inside_parens()`](https://lhdjung.github.io/scrutiny/reference/parens-extractors.md)
  : Extract substrings from before and inside parentheses
- [`row_to_colnames()`](https://lhdjung.github.io/scrutiny/reference/row_to_colnames.md)
  : Turn row values into column names

## Datasets

Small example datasets to demonstrate how
[`grim_map()`](https://lhdjung.github.io/scrutiny/reference/grim_map.md)
and
[`debit_map()`](https://lhdjung.github.io/scrutiny/reference/debit_map.md)
work

- [`pigs1`](https://lhdjung.github.io/scrutiny/reference/pigs1.md) :
  Means and sample sizes for GRIM-testing
- [`pigs2`](https://lhdjung.github.io/scrutiny/reference/pigs2.md) :
  Percentages and sample sizes for GRIM-testing
- [`pigs3`](https://lhdjung.github.io/scrutiny/reference/pigs3.md) :
  Binary means and standard deviations for using DEBIT
- [`pigs4`](https://lhdjung.github.io/scrutiny/reference/pigs4.md) :
  Data with duplications
- [`pigs5`](https://lhdjung.github.io/scrutiny/reference/pigs5.md) :
  Means, SDs, and sample sizes for GRIMMER-testing

## Superseded

- [`duplicate_detect()`](https://lhdjung.github.io/scrutiny/reference/duplicate_detect.md)
  **\[superseded\]** : Detect duplicate values

# Articles

### Consistency tests

- [GRIM](https://lhdjung.github.io/scrutiny/articles/grim.md):
- [GRIMMER](https://lhdjung.github.io/scrutiny/articles/grimmer.md):
- [DEBIT](https://lhdjung.github.io/scrutiny/articles/debit.md):

### Plausibility checks

- [Duplication
  analysis](https://lhdjung.github.io/scrutiny/articles/duplicates.md):

### Quick guides

- [Rounding
  options](https://lhdjung.github.io/scrutiny/articles/rounding-options.md):
- [Implementing your consistency
  test](https://lhdjung.github.io/scrutiny/articles/consistency-tests-simple.md):

### Developer tools

- [Rounding in
  depth](https://lhdjung.github.io/scrutiny/articles/rounding-in-depth.md):
- [Consistency tests in
  depth](https://lhdjung.github.io/scrutiny/articles/consistency-tests-in-depth.md):
- [Developer
  tools](https://lhdjung.github.io/scrutiny/articles/devtools.md):
- [Data
  wrangling](https://lhdjung.github.io/scrutiny/articles/wrangling.md):

### Other

- [Related
  software](https://lhdjung.github.io/scrutiny/articles/related.md):
